<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Where does Leucadia start?</title>
  <meta name="description" content="San Diego's most debated border. Tell us exactly where you think Leucadia begins and Encinitas ends." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:wght@400;600;700&display=swap" rel="stylesheet" />
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

  <main>

    <!-- â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section class="hero" id="top">
      <div class="container">
        <img src="img/logo.png" alt="Where does Leucadia start?" class="hero-logo" style="height:300px;" />
        <p class="eyebrow" style="margin-bottom:8px;">North County's most debated border</p>
        <p>
          Everyone who lives along the 101 has an opinion. The signs are vague,
          the locals are divided, and the city boundaries don't help.
          Drop a pin and settle the debate, or add to it!
        </p>
        <div class="hero-actions">
          <a href="#submit" class="btn btn-primary">Submit your answer</a>
        </div>
      </div>
    </section>

    <!-- â”€â”€ Stats bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="stats-bar">
      <div class="container">
        <span class="stat-number" id="submission-count">â€”</span>
        <span class="stat-label">answers submitted</span>
      </div>
    </div>

    <!-- â”€â”€ Community heat map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="community-map" style="padding: 64px 0 48px;">
      <div class="container">
        <h2 class="section-title">The community verdict</h2>
        <p style="font-size:0.95rem; color:var(--grey); margin-bottom:24px;">
          Each point represents one person's answer. Hotter zones mean more agreement.
          <span id="map-count"></span>
        </p>

        <div id="loading-msg" class="loading-msg">Loading answersâ€¦</div>
        <div id="heat-map" style="display:none;"></div>

        <div class="legend" id="legend" style="display:none;">
          <span>Fewer answers</span>
          <div class="legend-gradient"></div>
          <span>More answers</span>
        </div>

        <p style="font-size:0.85rem; color:var(--grey); margin-bottom:0; text-align:center;">
          Have an opinion? <a href="#submit">Add yours below.</a>
        </p>
      </div>
    </section>

    <hr class="divider" />

    <!-- â”€â”€ How it works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section class="how-it-works">
      <div class="container">
        <h2 class="section-title">How it works</h2>
        <div class="steps">
          <div class="step">
            <div class="step-num">1</div>
            <div class="step-body">
              <h3>Drop a pin</h3>
              <p>Use the map below to mark the exact spot where you think Leucadia begins â€” or Encinitas ends, depending on your loyalties.</p>
            </div>
          </div>
          <div class="step">
            <div class="step-num">2</div>
            <div class="step-body">
              <h3>Add context (optional)</h3>
              <p>Give a street name, landmark, or brief explanation. We love a good "it's definitely at the Lumberyard" argument.</p>
            </div>
          </div>
          <div class="step">
            <div class="step-num">3</div>
            <div class="step-body">
              <h3>Watch the map heat up</h3>
              <p>Your answer joins the community verdict above. Where do the clusters form? Is there consensus, or pure chaos?</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <hr class="divider" />

    <!-- â”€â”€ Submission form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="submit" style="padding: 32px 0 64px;">
      <div class="container">

        <div class="page-header">
          <h1>Submit your answer</h1>
          <p>Where do <em>you</em> think Leucadia starts? Drop a pin on the map below.</p>
        </div>

        <!-- Success state (hidden until submit) -->
        <div id="success-message">
          <div class="checkmark">ğŸ“</div>
          <h2>Pin dropped. Thanks.</h2>
          <p>Your answer has been added to the map. Let's see if anyone agrees with you.</p>
          <a href="#community-map" class="btn btn-primary">See the heat map</a>
          &nbsp;
          <a href="#top" class="btn btn-secondary">Back to top</a>
        </div>

        <!-- Form -->
        <div id="form-wrapper">
          <form id="submission-form" class="form-card" novalidate>

            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" id="name" name="name" placeholder="Your name" required autocomplete="name" />
            </div>

            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" placeholder="you@example.com" required autocomplete="email" />
              <p class="hint">Not shared publicly. We won't email you.</p>
            </div>

            <div class="form-group">
              <label for="answer">Your take (optional)</label>
              <textarea id="answer" name="answer" placeholder="e.g. &quot;It starts at Grandview â€” everyone knows this.&quot;"></textarea>
              <p class="hint">A street name, intersection, landmark, or whatever you want to say.</p>
            </div>

            <!-- Map pin drop -->
            <div class="form-group">
              <span class="map-label">Drop your pin <span style="color:var(--sunset)">*</span></span>
              <p class="map-hint">Click anywhere on the map to mark where you think Leucadia begins.</p>
              <div id="pin-map"></div>
              <p class="pin-coords" id="pin-coords"></p>
              <p class="pin-required-msg" id="pin-required-msg">Please drop a pin on the map before submitting.</p>
              <input type="hidden" id="lat" name="lat" />
              <input type="hidden" id="lng" name="lng" />
            </div>

            <button type="submit" class="btn btn-primary" id="submit-btn" style="width:100%; font-size:1rem; padding:15px;">
              Submit my answer
            </button>

          </form>
        </div>

      </div>
    </section>

  </main>

  <footer>
    <div class="container">
      <p>Copyright 2026 North County LLC</p>
    </div>
  </footer>

  <!-- Leaflet + leaflet-heat -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyY3Aj8_VBicP-p2lm5Me_uXqsWY_fYYUous6NRdh8D_y2hB6UaX96aLjFcfeSnSuHAQA/exec';
    const MAP_CENTER = [33.063, -117.299];

    // â”€â”€ Heat map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function initPage() {
      try {
        const res    = await fetch(SCRIPT_URL);
        const points = await res.json();

        // Set count first â€” before any Leaflet code can throw
        document.getElementById('submission-count').textContent =
          Array.isArray(points) ? points.length : '0';

        try {
          document.getElementById('loading-msg').style.display = 'none';
          document.getElementById('heat-map').style.display    = 'block';
          document.getElementById('legend').style.display      = 'flex';

          const heatMap = L.map('heat-map').setView(MAP_CENTER, 13);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
            maxZoom: 19,
          }).addTo(heatMap);
          heatMap.invalidateSize();

          if (!points || points.length === 0) {
            document.getElementById('map-count').textContent = 'No pinned answers yet â€” be the first!';
            return;
          }

          document.getElementById('map-count').textContent =
            `${points.length} answer${points.length === 1 ? '' : 's'} plotted.`;

          L.heatLayer(points, {
            radius: 28, blur: 20, maxZoom: 17,
            gradient: { 0.2: '#4575b4', 0.5: '#fee090', 1.0: '#d73027' },
          }).addTo(heatMap);

          const latlngs = points.map(p => [p[0], p[1]]);
          if (latlngs.length > 1) {
            heatMap.fitBounds(L.latLngBounds(latlngs), { padding: [40, 40], maxZoom: 15 });
          }
        } catch (mapErr) {
          console.error('Heat map render error:', mapErr);
          document.getElementById('loading-msg').style.display = 'block';
          document.getElementById('loading-msg').textContent   = 'Could not render map. Please try again later.';
          document.getElementById('heat-map').style.display    = 'none';
        }

      } catch (fetchErr) {
        console.error('Fetch error:', fetchErr);
        document.getElementById('submission-count').textContent = '?';
        document.getElementById('loading-msg').textContent = 'Could not load map data. Please try again later.';
      }
    }

    initPage();

    // â”€â”€ Pin-drop form map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const pinMap = L.map('pin-map').setView(MAP_CENTER, 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      maxZoom: 19,
    }).addTo(pinMap);

    const pinIcon = L.divIcon({
      className: '',
      html: `<div style="
        width:22px;height:22px;
        background:#e8531a;
        border:3px solid #fff;
        border-radius:50% 50% 50% 0;
        transform:rotate(-45deg);
        box-shadow:0 2px 8px rgba(0,0,0,0.3);
      "></div>`,
      iconSize: [22, 22],
      iconAnchor: [11, 22],
    });

    let marker = null;
    pinMap.on('click', function (e) {
      const { lat, lng } = e.latlng;
      if (marker) { marker.setLatLng(e.latlng); }
      else { marker = L.marker(e.latlng, { icon: pinIcon }).addTo(pinMap); }
      document.getElementById('lat').value = lat.toFixed(6);
      document.getElementById('lng').value = lng.toFixed(6);
      document.getElementById('pin-coords').textContent = `ğŸ“ ${lat.toFixed(5)}, ${lng.toFixed(5)}`;
      document.getElementById('pin-required-msg').style.display = 'none';
    });

    // â”€â”€ Form submission â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('submission-form').addEventListener('submit', async function (e) {
      e.preventDefault();
      const name   = document.getElementById('name').value.trim();
      const email  = document.getElementById('email').value.trim();
      const answer = document.getElementById('answer').value.trim();
      const lat    = document.getElementById('lat').value;
      const lng    = document.getElementById('lng').value;

      if (!lat || !lng) {
        document.getElementById('pin-required-msg').style.display = 'block';
        document.getElementById('pin-map').scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
      }
      if (!name || !email) { this.reportValidity(); return; }

      const btn = document.getElementById('submit-btn');
      btn.textContent = 'Submittingâ€¦';
      btn.disabled = true;

      try {
        await fetch(SCRIPT_URL, {
          method: 'POST', mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, answer, lat: parseFloat(lat), lng: parseFloat(lng) }),
        });
      } catch (err) { console.error('Submission error:', err); }

      document.getElementById('form-wrapper').style.display  = 'none';
      document.getElementById('success-message').style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>

</body>
</html>
